using FluentAssertions;
using NSubstitute;
using NUnit.Framework;
using System.Threading.Tasks;
using wikia.Api;
using wikia.Configuration;
using wikia.tests.core;

namespace wikia.unit.tests.WikiMercuryTests
{
    [TestFixture]
    [Category(TestType.Unit)]
    public class WikiMercuryTests
    {
        private WikiMercury _sut;
        private IWikiaHttpClient _wikiaHttpClient;
        private const string Url = "http://yugioh.fandom.com";

        [SetUp]
        public void Setup()
        {
            _sut = new WikiMercury(Url);
        }


        [Test]
        public async Task If_Invoked_Should_Return_Wikia_Variables()
        {
            // Arrange

            // Act
            var result = await _sut.WikiVariables();

            // Assert
            result.Should().NotBeNull();
        }


        [Test]
        public async Task Should_Invoke_GetString_Method_Once()
        {
            // Arrange
            _wikiaHttpClient.GetString(Arg.Any<string>()).Returns(@"{ ""data"": { ""appleTouchIcon"": { ""url"": ""https://vignette.wikia.nocookie.net/yugioh/images/b/bc/Wiki.png/revision/latest?cb=20070302001228"", ""size"": ""153x153"" }, ""articlePath"": ""/wiki/"", ""basePath"": ""https://yugioh.fandom.com"", ""dbName"": ""yugioh"", ""favicon"": ""https://vignette.wikia.nocookie.net/yugioh/images/6/64/Favicon.ico/revision/latest?cb=20090626015303"", ""id"": 410, ""isClosed"": false, ""htmlTitle"": { ""separator"": "" | "", ""parts"": [ ""Yu-Gi-Oh!"", ""FANDOM powered by Wikia"" ] }, ""language"": { ""content"": ""en"", ""contentDir"": ""ltr"" }, ""scriptPath"": """", ""siteName"": ""Yu-Gi-Oh!"", ""specialRobotPolicy"": null, ""surrogateKey"": ""wiki-410"", ""tracking"": { ""vertical"": ""games"", ""comscore"": { ""c7Value"": ""wikiacsid_games"" }, ""netzathleten"": { ""enabled"": true, ""url"": ""//tag.md-nx.com/nx/438359d5-7944-441e-8720-1ab8a1f65560/loader.js"" }, ""quantcast"": { ""labels"": ""Genre.action,Genre.adventure,Genre.anime,Genre.comic,Genre.fantasy,Media.movies,Media.tv,Media.comics,Media.cards"" } }, ""cacheBuster"": 8340058340012, ""cdnRootUrl"": ""https://slot1-images.wikia.nocookie.net"", ""contentNamespaces"": [ 0, 100, 102, 104, 106, 108, 112, 114, 116, 118, 120, 122, 124, 126, ""128"", ""130"", ""131"" ], ""defaultSkin"": ""oasis"", ""disableAnonymousEditing"": true, ""disableAnonymousUploadForMercury"": false, ""disableMobileSectionEditor"": false, ""discussionColorOverride"": """", ""enableCommunityData"": true, ""enableDiscussions"": true, ""enableDiscussionsImageUpload"": true, ""enableFandomAppSmartBanner"": true, ""enableLightweightContributions"": true, ""enableNewAuth"": true, ""fandomAppSmartBannerText"": null, ""homepage"": ""http://www.wikia.com/fandom"", ""isCoppaWiki"": true, ""isDarkTheme"": false, ""localNav"": [ { ""text"": ""Top Content"", ""href"": ""#"", ""children"": [ { ""text"": ""Most Visited"", ""href"": ""#"", ""children"": [ { ""text"": ""Duel Power"", ""href"": ""/wiki/Duel_Power"" }, { ""text"": ""Rising Rampage"", ""href"": ""/wiki/Rising_Rampage"" }, { ""text"": ""Dark Neostorm"", ""href"": ""/wiki/Dark_Neostorm"" }, { ""text"": ""Yu-Gi-Oh! VRAINS - Episode 095"", ""href"": ""/wiki/Yu-Gi-Oh!_VRAINS_-_Episode_095"" }, { ""text"": ""Arcana Force"", ""href"": ""/wiki/Arcana_Force"" }, { ""text"": ""The Infinity Chasers"", ""href"": ""/wiki/The_Infinity_Chasers"" }, { ""text"": ""Structure Deck R: Lord of Magician"", ""href"": ""/wiki/Structure_Deck_R:_Lord_of_Magician"" } ] }, { ""text"": ""Newly Changed"", ""href"": ""#"", ""children"": [ { ""text"": ""Divine Dragon Ragnarok"", ""href"": ""/wiki/Divine_Dragon_Ragnarok"" }, { ""text"": ""Armor Exe"", ""href"": ""/wiki/Armor_Exe"" }, { ""text"": ""Ancient Sorcerer"", ""href"": ""/wiki/Ancient_Sorcerer"" }, { ""text"": ""Amores of Prophecy"", ""href"": ""/wiki/Amores_of_Prophecy"" }, { ""text"": ""Millennium-Eyes Illusionist"", ""href"": ""/wiki/Millennium-Eyes_Illusionist"" }, { ""text"": ""Illusionist Faceless Magician"", ""href"": ""/wiki/Illusionist_Faceless_Magician"" }, { ""text"": ""LVP1-JP036"", ""href"": ""/wiki/LVP1-JP036"" } ] }, { ""text"": ""Random"", ""href"": ""/wiki/Special:Random"", ""children"": [ { ""text"": ""Random Page"", ""href"": ""/wiki/Special:Random"" }, { ""text"": ""Gallery"", ""href"": ""/wiki/Special:Random/Card_Gallery"" }, { ""text"": ""Rulings"", ""href"": ""/wiki/Special:Random/Card_Rulings"" }, { ""text"": ""Errata"", ""href"": ""/wiki/Special:Random/Card_Errata"" }, { ""text"": ""Tips"", ""href"": ""/wiki/Special:Random/Card_Tips"" }, { ""text"": ""Appearances‎"", ""href"": ""/wiki/Special:Random/Card_Appearances"" }, { ""text"": ""Trivia"", ""href"": ""/wiki/Special:Random/Card_Trivia"" } ] } ] }, { ""text"": ""Characters"", ""href"": ""/wiki/Category:Characters"", ""children"": [ { ""text"": ""VRAINS"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_VRAINS_characters"", ""children"": [ { ""text"": ""Anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_VRAINS_anime_characters"" } ] }, { ""text"": ""ARC-V"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_ARC-V_characters"", ""children"": [ { ""text"": ""Anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_ARC-V_anime_characters"" }, { ""text"": ""Manga"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_ARC-V_manga_characters"" } ] }, { ""text"": ""ZEXAL"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_ZEXAL_characters"", ""children"": [ { ""text"": ""Anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_ZEXAL_anime_characters"" }, { ""text"": ""Manga"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_ZEXAL_manga_characters"" }, { ""text"": ""D Team"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_D_Team_ZEXAL_characters"" } ] }, { ""text"": ""5D's"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_5D%27s_characters"", ""children"": [ { ""text"": ""Anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_5D%27s_anime_characters"" }, { ""text"": ""Manga"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_5D%27s_manga_characters"" } ] }, { ""text"": ""GX"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_GX_characters"", ""children"": [ { ""text"": ""Anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_GX_anime_characters"" }, { ""text"": ""Manga"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_GX_manga_characters"" } ] }, { ""text"": ""Yu-Gi-Oh!"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_characters"", ""children"": [ { ""text"": ""Second anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_anime_characters"" }, { ""text"": ""First anime"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_first_series_anime_characters"" }, { ""text"": ""Manga"", ""href"": ""/wiki/Portal:Yu-Gi-Oh!_manga_characters"" } ] } ] }, { ""text"": ""Card Gallery"", ""href"": ""/wiki/Category:Card_Gallery"", ""children"": [ { ""text"": ""Sets by language"", ""href"": ""/wiki/Category:Set_Card_Galleries"", ""children"": [ { ""text"": ""Japanese Set Card Gallery"", ""href"": ""/wiki/Category:Japanese_Set_Card_Galleries"" }, { ""text"": ""English Set Card Gallery"", ""href"": ""/wiki/Category:English_Set_Card_Galleries"" }, { ""text"": ""French Set Card Gallery"", ""href"": ""/wiki/Category:French_Set_Card_Galleries"" }, { ""text"": ""German Set Card Gallery"", ""href"": ""/wiki/Category:German_Set_Card_Galleries"" }, { ""text"": ""Italian Set Card Gallery"", ""href"": ""/wiki/Category:Italian_Set_Card_Galleries"" }, { ""text"": ""Portuguese Set Card Gallery"", ""href"": ""/wiki/Category:Portuguese_Set_Card_Galleries"" }, { ""text"": ""Spanish Set Card Gallery"", ""href"": ""/wiki/Category:Spanish_Set_Card_Galleries"" }, { ""text"": ""Korean Set Card Gallery"", ""href"": ""/wiki/Category:Korean_Set_Card_Galleries"" } ] }, { ""text"": ""Sets by type"", ""href"": ""/wiki/Category:Set_Card_Galleries"", ""children"": [ { ""text"": ""Unlimited Edition Set Card Gallery"", ""href"": ""/wiki/Category:Unlimited_Edition_Set_Card_Galleries"" }, { ""text"": ""1st Edition Set Card Gallery"", ""href"": ""/wiki/Category:1st_Edition_Set_Card_Galleries"" }, { ""text"": ""Limited Edition Set Card Gallery"", ""href"": ""/wiki/Category:Limited_Edition_Set_Card_Galleries"" }, { ""text"": ""Yu-Gi-Oh! GX Chapter Card Gallery"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_GX_Chapter_Card_Galleries"" }, { ""text"": ""Yu-Gi-Oh! 5D's Episode Card Gallery"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_5D%27s_Episode_Card_Galleries"" }, { ""text"": ""Yu-Gi-Oh! ZEXAL Episode Card Gallery"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_ZEXAL_Episode_Card_Galleries"" }, { ""text"": ""Yu-Gi-Oh! ARC-V Episode Card Gallery"", ""href"": ""/wiki/Category:Yu-Gi-Oh!_ARC-V_Episode_Card_Galleries"" } ] } ] }, { ""text"": ""Community"", ""href"": ""#"", ""children"": [ { ""text"": ""Current Events"", ""href"": ""/wiki/Yu-Gi-Oh!:Current_events"" }, { ""text"": ""Policies"", ""href"": ""/wiki/Category:Policy"" }, { ""text"": ""Forum"", ""href"": ""/wiki/Forum:Index"", ""children"": [ { ""text"": ""Yu-Gi-Oh! Ruling Queries"", ""href"": ""/wiki/Forum:Yu-Gi-Oh!_Ruling_Queries"" }, { ""text"": ""Yu-Gi-Oh! Deck Help"", ""href"": ""/wiki/Forum:Yu-Gi-Oh!_Deck_Help"" }, { ""text"": ""Yu-Gi-Oh! Lists Discussion"", ""href"": ""/wiki/Forum:Yu-Gi-Oh!_Lists_Discussion"" }, { ""text"": ""General Yu-Gi-Oh! Discussion"", ""href"": ""/wiki/Forum:General_Yu-Gi-Oh!_Discussion"" }, { ""text"": ""Duel Terminal"", ""href"": ""/wiki/Forum:Duel_Terminal"" }, { ""text"": ""Help desk"", ""href"": ""/wiki/Forum:Help_desk"" }, { ""text"": ""Yu-Gi-Oh! Wiki Community Discussion"", ""href"": ""/wiki/Forum:Yu-Gi-Oh!_Wiki_Community_Discussion"" }, { ""text"": ""Weekly Deck Competition"", ""href"": ""/wiki/Forum:Weekly_Deck_Competition"" } ] }, { ""text"": ""Recent Changes"", ""href"": ""/wiki/Special:RecentChanges"" }, { ""text"": ""Help"", ""href"": ""/wiki/Help:Contents"" } ] } ], ""mainPageTitle"": ""Yu-Gi-Oh!_Wikia"", ""namespaces"": { ""0"": """", ""1"": ""Talk"", ""2"": ""User"", ""3"": ""User_talk"", ""4"": ""Yu-Gi-Oh!"", ""5"": ""Yu-Gi-Oh!_talk"", ""6"": ""File"", ""7"": ""File_talk"", ""8"": ""MediaWiki"", ""9"": ""MediaWiki_talk"", ""10"": ""Template"", ""11"": ""Template_talk"", ""12"": ""Help"", ""13"": ""Help_talk"", ""14"": ""Category"", ""15"": ""Category_talk"", ""100"": ""Card_Gallery"", ""101"": ""Card_Gallery_talk"", ""102"": ""Card_Rulings"", ""103"": ""Card_Rulings_talk"", ""104"": ""Card_Errata"", ""105"": ""Card_Errata_talk"", ""106"": ""Card_Tips"", ""107"": ""Card_Tips_talk"", ""108"": ""Card_Trivia"", ""109"": ""Card_Trivia_talk"", ""110"": ""Forum"", ""111"": ""Forum_talk"", ""112"": ""Card_Appearances"", ""113"": ""Card_Appearances_talk"", ""114"": ""Portal"", ""115"": ""Portal_talk"", ""116"": ""Card_Lores"", ""117"": ""Card_Lores_talk"", ""118"": ""Card_Artworks"", ""119"": ""Card_Artworks_talk"", ""120"": ""Card_Names"", ""121"": ""Card_Names_talk"", ""122"": ""Set_Card_Lists"", ""123"": ""Set_Card_Lists_talk"", ""124"": ""Set_Card_Galleries"", ""125"": ""Set_Card_Galleries_talk"", ""126"": ""Set_Card_Ratios"", ""127"": ""Set_Card_Ratios_talk"", ""128"": ""Card_Sets"", ""129"": ""Card_Sets_talk"", ""130"": ""Transcript"", ""131"": ""Transcript_talk"", ""302"": ""Property"", ""303"": ""Property_talk"", ""304"": ""Type"", ""305"": ""Type_talk"", ""306"": ""Form"", ""307"": ""Form_talk"", ""308"": ""Concept"", ""309"": ""Concept_talk"", ""370"": ""Filter"", ""371"": ""Filter_talk"", ""828"": ""Module"", ""829"": ""Module_talk"", ""1200"": ""Message_Wall"", ""1201"": ""Thread"", ""1202"": ""Message_Wall_Greeting"", ""2000"": ""Board"", ""2001"": ""Board_Thread"", ""2002"": ""Topic"", ""-2"": ""Media"", ""-1"": ""Special"" }, ""qualarooUrl"": ""//s3.amazonaws.com/ki.js/52510/gQT.js"", ""recommendedVideoPlaylist"": """", ""recommendedVideoRelatedMediaId"": ""WNcPjgNz"", ""siteMessage"": ""Yu-Gi-Oh!"", ""theme"": { ""color-body"": ""#3b0902"", ""color-body-middle"": ""#3b0902"", ""color-page"": ""#ffffff"", ""color-buttons"": ""#fec356"", ""color-community-header"": ""#fec356"", ""color-links"": ""#0148c2"", ""color-header"": ""#fec024"", ""background-image"": ""https://images2.wikia.nocookie.net/__cb20130314221841/yugioh/images/5/50/Wiki-background"", ""background-image-width"": ""1920"", ""background-image-height"": ""805"", ""background-dynamic"": ""true"", ""page-opacity"": ""100"" }, ""twitterAccount"": ""@getfandom"", ""wikiCategories"": [ ""anime"" ], ""vertical"": ""games"", ""image"": ""https://vignette.wikia.nocookie.net/yugioh/images/b/bc/Wikia-Visualization-Main%2Cyugioh.png/revision/latest/window-crop/width/500/x-offset/0/y-offset/0/window-width/321/window-height/320?cb=20161102140946"", ""disableHTTPSDowngrade"": false } }");

            // Act
            await _sut.WikiVariables();

            // Assert
            await _wikiaHttpClient.Received(1).GetString(Arg.Any<string>());
        }
    }
}